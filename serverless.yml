service: wikimedia-bot

frameworkVersion: "3"

provider:
  name: aws
  runtime: nodejs20.x

  iam:
    role:
      statements:
        - Effect: "Allow"
          Action: ["dynamodb:GetItem", "dynamodb:PutItem"]
          Resource:
            {
              "Fn::Sub": "arn:aws:dynamodb:${AWS::Region}:${AWS::AccountId}:table/wikimedia_bot",
            }
        - Effect: "Allow"
          Action: ["ssm:GetParameter"]
          Resource:
            {
              "Fn::Sub": "arn:aws:ssm:${AWS::Region}:${AWS::AccountId}:parameter/wikimedia_bot/*",
            }

package:
  patterns:
    - "!node_modules/**"
    - "!src/**"
    - "dist/**"

functions:
  makePost:
    timeout: 60
    handler: dist/handler.handler
    layers:
      - arn:aws:lambda:${aws:region}:553035198032:layer:sharp:1
    events:
      # Invoke Lambda function once every 8 hours
      - schedule: rate(8 hours)

plugins:
  - serverless-esbuild

custom:
  esbuild:
    bundle: true
    minify: true
